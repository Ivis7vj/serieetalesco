[{"filePath":"E:\\mernstack_internship\\letterboard\\client\\src\\context\\AuthContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'getDoc' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":10,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"getDoc"},"fix":{"range":[313,321],"text":""},"desc":"Remove unused variable 'getDoc'."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":14,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":14,"endColumn":24},{"ruleId":"no-unused-vars","severity":2,"message":"'payload' is defined but never used.","line":161,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":161,"endColumn":33,"suggestions":[{"messageId":"removeVar","data":{"varName":"payload"},"fix":{"range":[5926,5933],"text":""},"desc":"Remove unused variable 'payload'."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { auth, db } from \"../firebase-config\";\r\nimport {\r\n    createUserWithEmailAndPassword,\r\n    signInWithEmailAndPassword,\r\n    signOut,\r\n    onAuthStateChanged,\r\n    sendPasswordResetEmail\r\n} from \"firebase/auth\";\r\nimport { doc, setDoc, getDoc, collection, query, where, getDocs, onSnapshot } from \"firebase/firestore\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport function useAuth() {\r\n    return useContext(AuthContext);\r\n}\r\n\r\nexport function AuthProvider({ children }) {\r\n    const [currentUser, setCurrentUser] = useState(null);\r\n    const [userData, setUserData] = useState(null); // Firestore profile data\r\n    const [globalPosters, setGlobalPosters] = useState({}); // Map: tmdbId -> posterPath\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    async function checkUsernameAvailability(username) {\r\n        const q = query(collection(db, \"users\"), where(\"username\", \"==\", username));\r\n        const querySnapshot = await getDocs(q);\r\n        return querySnapshot.empty;\r\n    }\r\n\r\n    async function signup(email, password, additionalData) {\r\n        const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n        const user = userCredential.user;\r\n\r\n        // Create user document in Firestore with optimized storage\r\n        await setDoc(doc(db, \"users\", user.uid), {\r\n            uid: user.uid,\r\n            email: user.email,\r\n            username: additionalData.username, // Save username\r\n            createdAt: new Date(),\r\n            dob: additionalData.dob || null, // Storing DOB as requested\r\n            bio: \"Movie enthusiast.\",\r\n            avatarUrl: \"\",\r\n            // Optimized Arrays for storage efficiency\r\n            watchlist: [], // Array of { tmdbId, type, addedAt }\r\n            favorites: [], // Array of tmdbIds\r\n            likes: [],     // Array of tmdbIds\r\n            watched: []    // Array of tmdbIds\r\n        });\r\n\r\n        return user;\r\n    }\r\n\r\n    async function login(username, password) {\r\n        // Assume input is username, try to find email\r\n        let emailToUse = username;\r\n\r\n        // If it doesn't look like an email, lookup the username\r\n        if (!username.includes('@')) {\r\n            const q = query(collection(db, \"users\"), where(\"username\", \"==\", username));\r\n            const querySnapshot = await getDocs(q);\r\n            if (!querySnapshot.empty) {\r\n                const userData = querySnapshot.docs[0].data();\r\n                emailToUse = userData.email;\r\n            } else {\r\n                throw new Error(\"Username not found\");\r\n            }\r\n        }\r\n\r\n        return signInWithEmailAndPassword(auth, emailToUse, password);\r\n    }\r\n\r\n    function logout() {\r\n        return signOut(auth);\r\n    }\r\n\r\n    async function verifyAndResetPassword(username, dob) {\r\n        const q = query(collection(db, \"users\"), where(\"username\", \"==\", username));\r\n        const querySnapshot = await getDocs(q);\r\n\r\n        if (querySnapshot.empty) {\r\n            throw new Error(\"Username not found\");\r\n        }\r\n\r\n        const userData = querySnapshot.docs[0].data();\r\n        if (userData.dob !== dob) {\r\n            throw new Error(\"Date of Birth does not match records\");\r\n        }\r\n\r\n        // Send reset email\r\n        await sendPasswordResetEmail(auth, userData.email);\r\n        return true;\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!auth) {\r\n            setLoading(false);\r\n            return;\r\n        }\r\n        // 1. Auth State Listener\r\n        const unsubscribeAuth = onAuthStateChanged(auth, (user) => {\r\n            setCurrentUser(user);\r\n            if (!user) {\r\n                setUserData(null);\r\n                setLoading(false);\r\n            }\r\n            // If user exists, loading calculation is deferred to data listener\r\n        });\r\n\r\n        return () => unsubscribeAuth();\r\n    }, []);\r\n\r\n    // 2. User Data & Posters Listener (Real-time)\r\n    useEffect(() => {\r\n        let unsubscribeData = () => { };\r\n        let unsubscribePosters = null;\r\n\r\n        if (currentUser) {\r\n            // User Data Listener (Firebase - still used for profile)\r\n            const docRef = doc(db, \"users\", currentUser.uid);\r\n            unsubscribeData = onSnapshot(docRef, (docSnap) => {\r\n                if (docSnap.exists()) {\r\n                    setUserData(docSnap.data());\r\n                }\r\n                setLoading(false); // Data ready\r\n            }, (error) => {\r\n                console.error(\"Error fetching user data:\", error);\r\n                setLoading(false);\r\n            });\r\n\r\n            // Posters Collection Listener (Supabase - NEW)\r\n            const fetchPostersRealtime = async () => {\r\n                const { supabase } = await import('../supabase-config');\r\n\r\n                // Initial fetch\r\n                const { data, error } = await supabase\r\n                    .from('user_posters')\r\n                    .select('series_id, poster_path')\r\n                    .eq('user_id', currentUser.uid);\r\n\r\n                if (!error && data) {\r\n                    const map = {};\r\n                    data.forEach(row => {\r\n                        if (row.series_id && row.poster_path) {\r\n                            map[row.series_id] = row.poster_path;\r\n                        }\r\n                    });\r\n                    setGlobalPosters(map);\r\n                }\r\n\r\n                // Subscribe to real-time changes\r\n                const channel = supabase\r\n                    .channel('user_posters_changes')\r\n                    .on(\r\n                        'postgres_changes',\r\n                        {\r\n                            event: '*',\r\n                            schema: 'public',\r\n                            table: 'user_posters',\r\n                            filter: `user_id=eq.${currentUser.uid}`\r\n                        },\r\n                        (payload) => {\r\n                            // Re-fetch on any change\r\n                            fetchPostersRealtime();\r\n                        }\r\n                    )\r\n                    .subscribe();\r\n\r\n                return () => {\r\n                    supabase.removeChannel(channel);\r\n                };\r\n            };\r\n\r\n            fetchPostersRealtime().then(unsub => {\r\n                unsubscribePosters = unsub;\r\n            });\r\n        }\r\n\r\n        return () => {\r\n            unsubscribeData();\r\n            if (unsubscribePosters) unsubscribePosters();\r\n        };\r\n    }, [currentUser]);\r\n\r\n    if (!auth) {\r\n        return (\r\n            <div style={{\r\n                height: '100vh',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                backgroundColor: '#111',\r\n                color: '#fff',\r\n                padding: '2rem',\r\n                textAlign: 'center'\r\n            }}>\r\n                <h1 style={{ color: '#ff4444', marginBottom: '1rem' }}>Configuration Error</h1>\r\n                <p style={{ fontSize: '1.2rem', marginBottom: '2rem' }}>\r\n                    The application cannot connect to Firebase.\r\n                </p>\r\n                <div style={{\r\n                    backgroundColor: '#222',\r\n                    padding: '1.5rem',\r\n                    borderRadius: '8px',\r\n                    maxWidth: '600px',\r\n                    textAlign: 'left'\r\n                }}>\r\n                    <strong style={{ display: 'block', marginBottom: '1rem', color: '#FFCC00' }}>Likely Cause: Missing Environment Variables</strong>\r\n                    <p style={{ marginBottom: '0.5rem' }}>If you are viewing this on Vercel:</p>\r\n                    <ol style={{ marginLeft: '1.5rem', lineHeight: '1.6' }}>\r\n                        <li>Go to your Vercel Project Dashboard.</li>\r\n                        <li>Navigate to <strong>Settings</strong> &gt; <strong>Environment Variables</strong>.</li>\r\n                        <li>Add the required keys (VITE_API_KEY, etc.) from your local <code>.env</code> file.</li>\r\n                        <li>Go to <strong>Deployments</strong> and <strong>Redeploy</strong>.</li>\r\n                    </ol>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const value = {\r\n        currentUser,\r\n        userData,\r\n        globalPosters, // Exposed for synchronous resolution\r\n        signup,\r\n        login,\r\n        logout,\r\n        checkUsernameAvailability,\r\n        verifyAndResetPassword\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {!loading && children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\mernstack_internship\\letterboard\\client\\src\\context\\NotificationContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { createContext, useContext, useState, useCallback, useRef } from 'react';\r\n\r\nconst NotificationContext = createContext();\r\n\r\nexport const useNotification = () => useContext(NotificationContext);\r\n\r\nexport const NotificationProvider = ({ children }) => {\r\n    const [state, setState] = useState({\r\n        isOpen: false,\r\n        type: 'alert', // 'alert' | 'confirm'\r\n        message: '',\r\n        title: '',\r\n        confirmLabel: 'Confirm',\r\n        cancelLabel: 'Cancel'\r\n    });\r\n\r\n    const resolveRef = useRef(null);\r\n\r\n    const close = useCallback(() => {\r\n        setState(prev => ({ ...prev, isOpen: false }));\r\n        // Clean up resolve ref after animation or immediately if no animation\r\n    }, []);\r\n\r\n    const alert = useCallback((message, title = 'Alert') => {\r\n        return new Promise((resolve) => {\r\n            setState({\r\n                isOpen: true,\r\n                type: 'alert',\r\n                message,\r\n                title,\r\n                confirmLabel: 'OK',\r\n                cancelLabel: ''\r\n            });\r\n            resolveRef.current = resolve;\r\n        });\r\n    }, []);\r\n\r\n    const confirm = useCallback((message, title = 'Confirm', confirmLabel = 'Yes', cancelLabel = 'No') => {\r\n        return new Promise((resolve) => {\r\n            setState({\r\n                isOpen: true,\r\n                type: 'confirm',\r\n                message,\r\n                title,\r\n                confirmLabel,\r\n                cancelLabel\r\n            });\r\n            resolveRef.current = resolve;\r\n        });\r\n    }, []);\r\n\r\n    const handleConfirm = () => {\r\n        if (resolveRef.current) resolveRef.current(true);\r\n        close();\r\n    };\r\n\r\n    const handleCancel = () => {\r\n        if (resolveRef.current) resolveRef.current(false);\r\n        close();\r\n    };\r\n\r\n    const handleAlertOk = () => {\r\n        if (resolveRef.current) resolveRef.current();\r\n        close();\r\n    };\r\n\r\n    return (\r\n        <NotificationContext.Provider value={{ alert, confirm }}>\r\n            {children}\r\n            {state.isOpen && (\r\n                <div style={styles.overlay} onClick={state.type === 'alert' ? handleAlertOk : handleCancel}>\r\n                    <div style={styles.modal} onClick={e => e.stopPropagation()}>\r\n                        <div style={styles.header}>\r\n                            {state.title}\r\n                        </div>\r\n                        <div style={styles.body}>\r\n                            {state.message}\r\n                        </div>\r\n                        <div style={styles.footer}>\r\n                            {state.type === 'confirm' ? (\r\n                                <>\r\n                                    <button style={styles.cancelBtn} onClick={handleCancel}>\r\n                                        {state.cancelLabel}\r\n                                    </button>\r\n                                    <button style={styles.confirmBtn} onClick={handleConfirm}>\r\n                                        {state.confirmLabel}\r\n                                    </button>\r\n                                </>\r\n                            ) : (\r\n                                <button style={styles.confirmBtn} onClick={handleAlertOk}>\r\n                                    {state.confirmLabel}\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </NotificationContext.Provider>\r\n    );\r\n};\r\n\r\nconst styles = {\r\n    overlay: {\r\n        position: 'fixed',\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n        bottom: 0,\r\n        backgroundColor: 'rgba(0, 0, 0, 0.85)',\r\n        backdropFilter: 'blur(4px)',\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        zIndex: 9999,\r\n        animation: 'fadeIn 0.2s ease-out'\r\n    },\r\n    modal: {\r\n        background: '#191919', // Prime Dark\r\n        border: 'none',\r\n        borderRadius: '8px',\r\n        padding: '30px',\r\n        minWidth: '350px',\r\n        maxWidth: '90%',\r\n        boxShadow: '0 10px 30px rgba(0,0,0,0.5)',\r\n        animation: 'scaleIn 0.2s ease-out',\r\n        color: '#f2f2f2',\r\n        fontFamily: '\"Amazon Ember\", Arial, sans-serif'\r\n    },\r\n    header: {\r\n        fontSize: '1.1rem',\r\n        fontWeight: '700',\r\n        marginBottom: '1rem',\r\n        color: '#ffffff',\r\n        textTransform: 'uppercase',\r\n        letterSpacing: '0.5px'\r\n    },\r\n    body: {\r\n        fontSize: '0.95rem',\r\n        color: '#bbbbbb', // Softer white\r\n        marginBottom: '2rem',\r\n        lineHeight: '1.5'\r\n    },\r\n    footer: {\r\n        display: 'flex',\r\n        justifyContent: 'flex-end',\r\n        gap: '15px'\r\n    },\r\n    confirmBtn: {\r\n        background: '#FFCC00', // Yellow\r\n        color: '#000000', // Black Text\r\n        border: 'none',\r\n        padding: '10px 25px',\r\n        borderRadius: '4px',\r\n        fontWeight: 'bold',\r\n        cursor: 'pointer',\r\n        fontSize: '0.95rem',\r\n        textTransform: 'uppercase',\r\n        boxShadow: '0 2px 5px rgba(0,0,0,0.2)',\r\n        fontFamily: 'sans-serif'\r\n    },\r\n    cancelBtn: {\r\n        background: 'transparent',\r\n        color: '#FFCC00', // Yellow Text\r\n        border: '1px solid #FFCC00', // Yellow Border\r\n        padding: '10px 25px',\r\n        borderRadius: '4px',\r\n        cursor: 'pointer',\r\n        fontSize: '0.95rem',\r\n        fontWeight: 'bold',\r\n        textTransform: 'uppercase',\r\n        transition: 'all 0.2s'\r\n    }\r\n};\r\n\r\n// Add global styles for animation if not present\r\nif (typeof document !== 'undefined') {\r\n    const styleSheet = document.createElement(\"style\");\r\n    styleSheet.innerText = `\r\n        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\r\n        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }\r\n    `;\r\n    document.head.appendChild(styleSheet);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\mernstack_internship\\letterboard\\client\\src\\context\\OnboardingContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":5,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":5,"endColumn":27},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":33,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\n\r\nconst OnboardingContext = createContext();\r\n\r\nexport const useOnboarding = () => useContext(OnboardingContext);\r\n\r\nexport const OnboardingProvider = ({ children }) => {\r\n    // Current active indicator ID (only one at a time)\r\n    const [activeIndicatorId, setActiveIndicatorId] = useState(null);\r\n\r\n    // Track seen indicators to prevent repetition\r\n    const [seenIds, setSeenIds] = useState(() => {\r\n        try {\r\n            const stored = localStorage.getItem('seen_mobile_indicators');\r\n            if (stored) return new Set(JSON.parse(stored));\r\n\r\n            // Legacy User Check: If no onboarding data but user has history, DISABLE onboarding\r\n            // Checks for: stored user session, recent searches, or other app keys\r\n            const hasLegacyData = localStorage.getItem('currentUser') || localStorage.getItem('recentSearches');\r\n\r\n            if (hasLegacyData) {\r\n                // Mark as fully onboarded implicitly\r\n                // formatting: we use a special 'ALL_DISABLED' tag or just save it immediately\r\n                const disabledSet = new Set(['ALL_DISABLED']);\r\n                // Side effect in initializer? Better to do it in effect, but we need immediate state.\r\n                // We'll return it, and let the effect below sync it if needed, or just rely on state.\r\n                // We should write to LS to persist this decision.\r\n                localStorage.setItem('seen_mobile_indicators', JSON.stringify(['ALL_DISABLED']));\r\n                return disabledSet;\r\n            }\r\n\r\n            return new Set();\r\n        } catch (e) {\r\n            return new Set();\r\n        }\r\n    });\r\n\r\n    // Helper to check if mobile\r\n    const isMobile = () => window.innerWidth <= 768;\r\n\r\n    const markSeen = useCallback((id) => {\r\n        setSeenIds(prev => {\r\n            if (prev.has(id)) return prev;\r\n            const next = new Set(prev);\r\n            next.add(id);\r\n            localStorage.setItem('seen_mobile_indicators', JSON.stringify([...next]));\r\n            return next;\r\n        });\r\n    }, []);\r\n\r\n    const requestShow = useCallback((id) => {\r\n        // Strict Rules:\r\n        // 1. Must be mobile\r\n        // 2. Must not be already seen\r\n        // 3. Must not have another indicator active (First Come, First Served per session interaction)\r\n        // 4. Global \"has_seen_mobile_indicators\" flag from prompt logic? \r\n        //    User asked for \"seen_watch_button_tip\" etc, stored in \"has_seen_mobile_indicators\" flag? \r\n        //    Actually prompt said: \"Store completion flag: has_seen_mobile_indicators = true (optional per feature flags)\".\r\n        //    I will stick to per-feature flags within a set for granular control as requested in the map.\r\n\r\n        if (!isMobile()) return;\r\n        if (seenIds.has(id) || seenIds.has('ALL_DISABLED')) return;\r\n\r\n        setActiveIndicatorId(current => {\r\n            if (current) return current; // Block if something else is showing\r\n            return id;\r\n        });\r\n    }, [seenIds]);\r\n\r\n    const dismiss = useCallback((id) => {\r\n        setActiveIndicatorId(current => {\r\n            if (current === id) return null;\r\n            return current;\r\n        });\r\n        if (id) markSeen(id);\r\n    }, [markSeen]);\r\n\r\n    // Global Interaction Listener to dismiss ANY active indicator\r\n    useEffect(() => {\r\n        if (!activeIndicatorId) return;\r\n\r\n        const handleInteraction = () => {\r\n            dismiss(activeIndicatorId);\r\n        };\r\n\r\n        // Capture phase to catch clicks before they might trigger other things, \r\n        // effectively \"dismiss immediately\".\r\n        // Note: User said \"Dismiss instantly if User taps anywhere or User scrolls\".\r\n\r\n        window.addEventListener('touchstart', handleInteraction, { passive: true });\r\n        window.addEventListener('scroll', handleInteraction, { passive: true });\r\n        window.addEventListener('click', handleInteraction, { passive: true });\r\n\r\n        return () => {\r\n            window.removeEventListener('touchstart', handleInteraction);\r\n            window.removeEventListener('scroll', handleInteraction);\r\n            window.removeEventListener('click', handleInteraction);\r\n        };\r\n    }, [activeIndicatorId, dismiss]);\r\n\r\n    return (\r\n        <OnboardingContext.Provider value={{ activeIndicatorId, requestShow, dismiss }}>\r\n            {children}\r\n        </OnboardingContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\mernstack_internship\\letterboard\\client\\src\\context\\ThemeContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":5,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":5,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst ThemeContext = createContext();\r\n\r\nexport const useTheme = () => useContext(ThemeContext);\r\n\r\nexport const ThemeProvider = ({ children }) => {\r\n    // Check localStorage or system preference, default to dark for this app\r\n    const [theme, setTheme] = useState(() => {\r\n        const savedTheme = localStorage.getItem('app-theme');\r\n        if (savedTheme) return savedTheme;\r\n        return 'dark'; // Default to dark as per original design\r\n    });\r\n\r\n    useEffect(() => {\r\n        const root = window.document.documentElement;\r\n\r\n        // Remove old theme class\r\n        root.classList.remove('light-mode', 'dark-mode');\r\n\r\n        // Add new theme class\r\n        root.classList.add(`${theme}-mode`);\r\n\r\n        // Save to local storage\r\n        localStorage.setItem('app-theme', theme);\r\n    }, [theme]);\r\n\r\n    const toggleTheme = () => {\r\n        setTheme((prev) => (prev === 'dark' ? 'light' : 'dark'));\r\n    };\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, toggleTheme }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]}]